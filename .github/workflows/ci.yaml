name: Tests

on:
  push:

jobs:
  lint:
    name: Lint (PHP ${{ matrix.php-version }})
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php-version: &php-versions ['7.1', '7.2', '7.3', '7.4', '8.0', '8.1', '8.2', '8.3']

    steps:
      - uses: actions/checkout@v3

      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          extensions: curl, dom, json, mbstring, tokenizer, xml, xmlwriter, fileinfo
          coverage: none

      - uses: ./.github/actions/composer-install

      - run: ./vendor/bin/parallel-lint . --exclude ./vendor


  phpunit:
    name: Unit test (PHP ${{ matrix.php-version }})
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php-version: *php-versions

    steps:
      - uses: actions/checkout@v3

      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          extensions: curl, dom, json, mbstring, tokenizer, xml, xmlwriter, fileinfo
          coverage: none

      - uses: ./.github/actions/composer-install

      - run: ./vendor/bin/phpunit
